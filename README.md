# UART-FourServoControllBoard

## 概要 (Overview)

**UART-FourServoControllBoard** (以下UART-FSCB) は、わずか **22.82mm x 23.62mm** のサイズに、ロボットアーム制御に必要な機能をおおよそ詰め込んだ4軸スマートサーボコントローラ
従来のPCA9685等の単なるPWMドライバとは異なり、**電流・電圧・温度監視**、**USB-PD** 機能を搭載。MG996Rなどのハイパワーサーボ使用時でも、電流値と消費電力を監視しながら安全に駆動することが可能

## 特徴 (Features)

* **超小型サイズ:** 22.82mm x 23.62mm
* **USB PD対応:** CCピン制御により、モバイルバッテリーやPD充電器から5V/3Aを直接引き出し可能
  * PPSもそのうち対応
  * USB経由の通信対応
  * 背面PADに4.7k抵抗を直列でショートさせることでDLM移行
    * USB経由の書き込み可能
* **電流監視機能:**
  * ローサイド電流検知回路を搭載（CH32X035内蔵OPA + 20mΩシャント抵抗）
  * サーボの負荷状態をモニタリングし、過負荷時の緊急停止などが実装可能
  * 停止閾値などは別途ソフトウェアで書き込み可能
* **電圧監視機能**
  * 分圧抵抗によって電圧を監視可能
  * PPSと組み合わせたフィードバック制御も行う予定
* **温度監視**
  * NTCサーミスタによってVBUS-GNDに近い位置の温度計測が可能
* **プロッティング**
  * Goによるスクリプトによってパラメータの制御やプロッティング、プログラム書き込みなどが可能になる予定。
  * /firmware, /softwareにソースあり
* **MCU:** WCH CH32X035F7P6 (RISC-V, 48MHz)
* **制御IF:** 1Wire-UART, USB
* **その他:**
  * 外部電源入出力ピンヘッダx2 (バッテリー駆動対応、BMS無し)
  * デイジーチェーン対応 (1Wire-UARTかつ電源ピン仕様時)
  * デバック用1.27ピンヘッダ搭載
  * 片面実装
  * 手ハンダ可能 (難易度は高い)
  * XC6206 LDOによる安定した3.3V系電源
    * より高耐圧な互換LDOによるさらなる高電圧対応

## 仕様 (Specifications)

| 項目 | 内容 |
| :--- | :--- |
| **MCU** | WCH CH32X035F7P6 (TSSOP-20) |
| **入力電圧** | USB VBUS (5V-20V) または EXT_IN (5V〜20V) |
| **ロジック電圧** | 3.3V (XC6206 LDO内蔵) |
| **出力チャンネル** | 4PWM |
| **通信** | 1-Wire UARTx2 (Default: 115200bps, 8N1) |
| **電流検知** | 0 〜 6.8A (Full Scale) |
| **コンデンサ** | 100uF / 35V (Polymer) + 22uF (Ceramic) |
| **基板サイズ** | 22.86mm x 23.62mm |

## 開発環境 (Development)

* **IDE:** Goland, CLion
* **Framework:** pio, ch32fun
* **Writer:** WCH-LinkE

## 設計データ (Design Data)

* **EDA:** KiCad 9.0
* **PCB:** 2層基板 (1.6mm厚推奨)
